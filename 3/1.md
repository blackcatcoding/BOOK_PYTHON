# 服务器起航

> 从在浏览器输入网址，到能看到网页，虽然可能只有短短的0.1秒，但这其中计算机执行了多少条命令，网页又经过了怎样的迂回曲折才呈现在你的面前的呢？

![](..\.gitbook\assets\3\1.png)



## 计算机网络连接

> 通常情况下，浏览器在一台计算机上，而显示的网页在另外一台计算机上，它们之间通过网络连接。

![](..\.gitbook\assets\3\2.png)

## 域名与IP

> 网址表示想要访问的页面，不同网址会对应不同页面。网址中包含域名，域名一般以www开始，以.cn或者.com,.org等结尾，同一个域名下可以有多个网址。

![](..\.gitbook\assets\3\3.png)



> 网络是由多台计算机组成的，如何定位到其中的一台计算机呢？可以给计算机编号，由此ip地址应运而生。当前使用的大部分ip地址说ipv4地址，ipv4由32位组成，为方便书写用点分隔成4段，每段8位，2的8次方等于256，所以每一位的范围是0-255，ipv4总共有43亿个地址。

![](..\.gitbook\assets\3\4.png)



> 那么域名和ip地址又是怎么对应起来的呢，对于浏览器来说，输入网址后，它会从网址中取出域名，然后通过访问DNS获得域名对应的ip地址。DNS表示域名服务器，可以理解为DNS有一张表，表中记录了所有的域名和ip地址的对应关系，只要你给我域名，我给你查出对应的ip地址。

![](..\.gitbook\assets\3\5.png)



## 服务器

> 你的计算机拿到另外一台计算机的ip地址后，你的计算机就会将你的请求发送给ip地址对应的那台计算机，其他计算机也会发出同样的请求，这样的请求都通过网络来到了这台目标计算机，像这样的被其他计算机访问的计算机，称为服务器。

![](..\.gitbook\assets\3\6.png)



## 端口号

> 一台服务器上可以同时提供多种不同的服务：Web服务，也就是提供网页；FTP服务，提供文件存储和访问；邮件服务，提供电子邮件收发，这些服务分别由不同的服务器程序来完成。但是一个网络请求来到服务器，服务器怎么知道这个请求想要什么服务呢？

![](..\.gitbook\assets\3\7.png)



> 浏览器发送请求时可以携带信息给服务器，告诉服务器获取哪种服务就可以了。那这个信息在计算机系统其实就是“端口号”。

![](..\.gitbook\assets\3\8.png)

> 我们在使用浏览器时，没有用过端口号。实际上在发送请求时，如果是获取网页，浏览器自动添加了默认端口。

![](..\.gitbook\assets\3\9.png)



## 响应

> 通过刚才的一系统步骤，浏览器端的请求已经找到了服务器这台计算机，并且由服务器上某个具体的服务器程序来处理请求。然后服务器程序根据网址中不同的路径或者文件名给浏览器返回对应的页面。
>
> 当服务器返回的内容通过网络到达浏览器，经由浏览器解析后就显示出来。这里，将服务器给浏览器返回的内容，称之为响应。

![](..\.gitbook\assets\3\10.png)

> 从输入网址开始到看到网页的整个流程就是这样的，对于计算机和网络来说，这些事情可能只用了0.1秒，但要理解这个流程，还是要花些功夫的。



## Flask框架

Flask诞生于2010年，是Armin ronacher（人名）用Python语言基于Werkzeug工具箱编写的轻量级Web开发框架。它主要面向需求简单的小应用。

Flask本身相当于一个内核，其他几乎所有的功能都要用到扩展（邮件扩展Flask-Mail，用户认证Flask-Login），都需要用第三方的扩展来实现。比如可以用Flask-extension加入ORM、窗体验证工具，文件上传、身份验证等。Flask没有默认使用的数据库，你可以选择MySQL，也可以用NoSQL。其 WSGI 工具箱采用 Werkzeug（路由模块） ，模板引擎则使用 Jinja2 。

可以说Flask框架的核心就是Werkzeug和Jinja2。

Python最出名的框架要数Django，此外还有Flask、Tornado等框架。虽然Flask不是最出名的框架，但是Flask应该算是最灵活的框架之一，这也是Flask受到广大开发者喜爱的原因。

### Flask扩展包

- Flask-SQLalchemy：操作数据库；
- Flask-migrate：管理迁移数据库；
- Flask-Mail:邮件；
- Flask-WTF：表单；
- Flask-script：插入脚本；
- Flask-Login：认证用户状态；
- Flask-RESTful：开发REST API的工具；
- Flask-Bootstrap：集成前端Twitter Bootstrap框架；
- Flask-Moment：本地化日期和时间；



### Hello,World!

```python
# 从flask模块导入Flask类

from flask import Flask

# 创建flask对象app
app = Flask(__name__)

# 设置访问路径
@app.route('/hello')
def hello():

    # 返回响应内容
    return 'Hello, World!'

if __name__ == '__main__':

    # 启动服务器程序
    app.run(host='127.0.0.1', port='8080')
```



然而，如果我们想要更改返回的响应内容，比如`return 'Hello, cat!'`，刷新网页并没有改变，需要重启服务器，这样比较麻烦，我们可以开启调试功能，修改代码保存后，直接刷新网页就可以访问新的内容。

```python
app.debug = True
```



### 返回页面

返回信息本质上是一个字符串，但是我们把字符串加上html的标签也可以渲染出来，比如`return '<h1>Hello, cat!</h1>'`，返回的文字就是一个标题，然而网页构成很复杂，我们不可能把所有的内容都通过return返回。

```python
from flask render_template
return render_template('index.html')
```



### Flask目录结构

在flask目录中，app.py是主应用程序，templates中存放用到的HTML文件，注意这个目录必须是templates，如果不是这个目录名，就导致flask程序找不到页面的。css、js，图片文件等这些，放在和templates同级的static目录下，为了对这些文件进行更好地管理，一般会在static目录中创建js、css、image目录分别存放。

<img src="..\.gitbook\assets\3\11.png" style="zoom:67%;" />

# 路由

在我们生活中，有很多很多的工厂，比如饮料工厂生产饮料，服装工厂生产服装，每个工厂都有各自的功能。

![](..\.gitbook\assets\3\12.png)



想找到服装工厂，首先得知道服装工厂的地址，然后沿着路线就可以找到服装工厂。如果想去饮料工厂，同样的也得知道地址，才能够找到对应的工厂。

![](..\.gitbook\assets\3\13.png)



那就是说，想要找不同的工厂，首先都要知道他们的地址。

![](..\.gitbook\assets\3\14.png)



flask对象有一个方法可以帮助我们给页面绑定对应的地址，它就是route方法。

这里定义了一个函数，这个函数可以展示页面，函数类似于我们生活中的工厂，可以执行不同的操作。我们现在要做的是给他绑定地址。

具体的规则是这样的：在函数的上方，首先写@符号，@符号后跟的是flask对象名称。点代表的。route方法，在方法中，填写要绑定的地址。这样就完成了一个完整的路由。此时，这里的函数被称为视图函数。

![](..\.gitbook\assets\3\15.png)



## 动态路由

通过输入不同的路由名称可以访问不同的页面，但是这样有很多个页面的话，就要完成很多个路由，写很多重复的代码，能不能有更简单的办法呢？

<img src="..\.gitbook\assets\3\17.png" style="zoom: 67%;" />

之前的路由在route方法中填写的是固定的地址。现在需要根据输入的地址来进行不同的操作，所以可以把地址写为参数的形式。并且在对应的视图函数中接收参数，根据参数进行相应的操作。这就是动态路由。需要注意的是，视图函数中获取的参数类型，都是字符串类型的。

## 流程分析

首先使用动态路由，设置参数，然后在对应的视图函数中获取参数，根据获取的参数，展示参数对应的html页面。

所有的学生档案页面都是以学生名字命名的，比如说`小明.html`,`小红.html`等等。

<img src="..\.gitbook\assets\3\18.png" style="zoom: 67%;" />

## 动态路由练习

> 1.完成服务器项目，在地址栏输入数字，这个数字对应正方形的边长，最终返回正方形的面积。

<img src="..\.gitbook\assets\3\19.png" style="zoom: 67%;" />



> 2.文件夹中有 pony.html 和 series.html 文件，使用动态路由完成代码：输入不同的地址访问不同的页面。

<img src="..\.gitbook\assets\3\20.png" style="zoom: 67%;" />

# HTTP协议

HTTP协议（也叫作超文本传输协议）：是简单的请求-响应协议,规定了请求和响应格式。通俗来说就是互联网的一种网络传输协议，所有的网页的请求响应都必须遵守这个标准。比如客户端发送信息“请求/pig页面”，那么服务端就要回复信息“OK，页面已返回”作为响应，目的就是让信息能够快速准确的传达。

<img src="..\.gitbook\assets\3\21.png" style="zoom: 67%;" />

## HTTP请求格式

HTTP请求由`请求行、请求头、请求体`组成。

<img src="..\.gitbook\assets\3\22.png" style="zoom: 67%;" />



## HTTP请求行

HTTP请求行结构是：请求方式 + 路由 + HTTP版本

- 请求方式：也叫请求方法，就是告诉服务器要执行什么操作，比如GET请求，除了GET,还有删除、更新等请求方式。

- 路由：对应flask中route方法绑定的地址/pig，刚才的请求方式就表示要执行什么操作，那对谁进行操作呢？就是对这里的路由。

- HTTP版本：HTTP协议最初是一个版本，后来根据新需要，更新一部分内容，就命名为新的版本号。目前最新的是2.0版本，使用较多的是1.1版本。

<img src="..\.gitbook\assets\3\23.png" style="zoom: 50%;" />



## HTTP请求头

请求头由`关键字`和`值`组成，每行一对，关键字和值用英文冒号`:`分隔。，比如 `Accept：*/*`表示浏览器可接受的文件类型，`Host: 127.0.0.1:8000`表示主机和端口号，`User-Agent: HTTPie/2.0.0`表示浏览器类型。

<img src="..\.gitbook\assets\3\24.png" style="zoom: 50%;" />

## HTTP请求体

HTTP请求体也叫请求正文，结构是也是“关键字”和“值” 组成，关键字和值用“等于”号连接，多个“关键字=值”中间用“&”符号连接。举例：比如登录请求中，要发送 用户名和密码，就是name=tom&password=1234。



## HTTPie

想要查看请求信息，就要用到HTTPie这个工具，它是一个 HTTP 客户端，可以发送任意 HTTP 请求，不过需要我们安装一下，执行`pip install httpie`命令即可。打开cmd 命令窗口，输入`http`关键字 然后输入请求的url 最后，加入参数-v表示打印请求和响应信息。

<img src="..\.gitbook\assets\3\25.png" style="zoom: 50%;" />

<img src="..\.gitbook\assets\3\26.png" style="zoom: 70%;" />